import{j as l,a as v,o as R}from"./ui-BoESCd6g.js";import{r as p,a as C}from"./vendor-Bn94jRP8.js";import{T,o as S,S as B,n as M,i as A,a as h,b as j,d,c as y,e as D,f as g,g as U,h as z,j as F,k as I,X as N,l as P,m as q,A as b,p as k,q as H,r as V,s as Y,t as X,P as x,u as G,C as W,v as w,w as Q,x as J,y as K}from"./index-DZB4hbiH.js";class u extends T{constructor(){const t=S(u.getDefaults(),arguments,["callback","value"]);super(t),this.name="ToneEvent",this._state=new B("stopped"),this._startOffset=0,this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(T.getDefaults(),{callback:M,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,s=>{let e;if(s.state==="started"){s.id!==-1&&this.context.transport.clear(s.id);const a=s.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||A(this._loop)&&this._loop>1){e=1/0,A(this._loop)&&(e=this._loop*this._getLoopDuration());const o=this._state.getAfter(a);o!==null&&(e=Math.min(e,o.time-a)),e!==1/0&&(e=new h(this.context,e));const r=new h(this.context,this._getLoopDuration());s.id=this.context.transport.scheduleRepeat(this._tick.bind(this),r,new h(this.context,a),e)}else s.id=this.context.transport.schedule(this._tick.bind(this),new h(this.context,a))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){const s=this.toTicks(t);return this._state.getValueAtTime(s)==="stopped"&&(this._state.add({id:-1,state:"started",time:s}),this._rescheduleEvents(s)),this}stop(t){this.cancel(t);const s=this.toTicks(t);if(this._state.getValueAtTime(s)==="started"){this._state.setStateAtTime("stopped",s,{id:-1});const e=this._state.getBefore(s);let a=s;e!==null&&(a=e.time),this._rescheduleEvents(a)}return this}cancel(t){t=d(t,-1/0);const s=this.toTicks(t);return this._state.forEachFrom(s,e=>{this.context.transport.clear(e.id)}),this._state.cancel(s),this}_tick(t){const s=this.context.transport.getTicksAtTime(t);if(!this.mute&&this._state.getValueAtTime(s)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let e=.02;j(this.humanize)||(e=this.toSeconds(this.humanize)),t+=(Math.random()*2-1)*e}this.callback(t,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new h(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new h(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const t=this.context.transport.ticks,s=this._state.get(t);if(s!==null&&s.state==="started"){const e=this._getLoopDuration();return(t-s.time)%e/e}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class _ extends u{constructor(){const t=S(_.getDefaults(),arguments,["callback","events"]);super(t),this.name="Part",this._state=new B("stopped"),this._events=new Set,this._state.increasing=!0,t.events.forEach(s=>{y(s)?this.add(s[0],s[1]):this.add(s)})}static getDefaults(){return Object.assign(u.getDefaults(),{events:[]})}start(t,s){const e=this.toTicks(t);if(this._state.getValueAtTime(e)!=="started"){s=d(s,this._loop?this._loopStart:0),this._loop?s=d(s,this._loopStart):s=d(s,0);const a=this.toTicks(s);this._state.add({id:-1,offset:a,state:"started",time:e}),this._forEach(o=>{this._startNote(o,e,a)})}return this}_startNote(t,s,e){s-=e,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<e&&(s+=this._getLoopDuration()),t.start(new h(this.context,s))):t.startOffset<this._loopStart&&t.startOffset>=e&&(t.loop=!1,t.start(new h(this.context,s))):t.startOffset>=e&&t.start(new h(this.context,s))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach(s=>{s.startOffset+=this._startOffset})}stop(t){const s=this.toTicks(t);return this._state.cancel(s),this._state.setStateAtTime("stopped",s),this._forEach(e=>{e.stop(t)}),this}at(t,s){const e=new D(this.context,t).toTicks(),a=new h(this.context,1).toSeconds(),o=this._events.values();let r=o.next();for(;!r.done;){const n=r.value;if(Math.abs(e-n.startOffset)<a)return g(s)&&(n.value=s),n;r=o.next()}return g(s)?(this.add(t,s),this.at(t)):null}add(t,s){t instanceof Object&&Reflect.has(t,"time")&&(s=t,t=s.time);const e=this.toTicks(t);let a;return s instanceof u?(a=s,a.callback=this._tick.bind(this)):a=new u({callback:this._tick.bind(this),context:this.context,value:s}),a.startOffset=e,a.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(a),this._restartEvent(a),this}_restartEvent(t){this._state.forEach(s=>{s.state==="started"?this._startNote(t,s.time,s.offset):t.stop(new h(this.context,s.time))})}remove(t,s){return U(t)&&t.hasOwnProperty("time")&&(s=t,t=s.time),t=this.toTicks(t),this._events.forEach(e=>{e.startOffset===t&&(z(s)||g(s)&&e.value===s)&&(this._events.delete(e),e.dispose())}),this}clear(){return this._forEach(t=>t.dispose()),this._events.clear(),this}cancel(t){return this._forEach(s=>s.cancel(t)),this._state.cancel(this.toTicks(t)),this}_forEach(t){return this._events&&this._events.forEach(s=>{s instanceof _?s._forEach(t):t(s)}),this}_setAll(t,s){this._forEach(e=>{e[t]=s})}_tick(t,s){this.mute||this.callback(t,s)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):t.state==="stopped"&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(t){this._loop=t,this._forEach(s=>{s.loopStart=this.loopStart,s.loopEnd=this.loopEnd,s.loop=t,this._testLoopBoundries(s)})}get loopEnd(){return new h(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach(s=>{s.loopEnd=t,this._testLoopBoundries(s)})}get loopStart(){return new h(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach(s=>{s.loopStart=this.loopStart,this._testLoopBoundries(s)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}class E extends u{constructor(){const t=S(E.getDefaults(),arguments,["callback","events","subdivision"]);super(t),this.name="Sequence",this._part=new _({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[],this._subdivision=this.toTicks(t.subdivision),this.events=t.events,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.playbackRate=t.playbackRate,this.probability=t.probability,this.humanize=t.humanize,this.mute=t.mute,this.playbackRate=t.playbackRate}static getDefaults(){return Object.assign(F(u.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(t,s){s!==null&&!this.mute&&this.callback(t,s)}get events(){return this._events}set events(t){this.clear(),this._eventsArray=t,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(t,s){return this._part.start(t,s&&this._indexTime(s)),this}stop(t){return this._part.stop(t),this}get subdivision(){return new h(this.context,this._subdivision).toSeconds()}_createSequence(t){return new Proxy(t,{get:(s,e)=>s[e],set:(s,e,a)=>(I(e)&&isFinite(parseInt(e,10))&&y(a)?s[e]=this._createSequence(a):s[e]=a,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(t,s,e){t.forEach((a,o)=>{const r=o*s+e;if(y(a))this._rescheduleSequence(a,s/a.length,r);else{const n=new h(this.context,r,"i").toSeconds();this._part.add(n,a)}})}_indexTime(t){return new h(this.context,t*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(t){this._part.loop=t}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this._part.loopStart=this._indexTime(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,t===0?this._part.loopEnd=this._indexTime(this._eventsArray.length):this._part.loopEnd=this._indexTime(t)}get startOffset(){return this._part.startOffset}set startOffset(t){this._part.startOffset=t}get playbackRate(){return this._part.playbackRate}set playbackRate(t){this._part.playbackRate=t}get probability(){return this._part.probability}set probability(t){this._part.probability=t}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(t){this._part.humanize=t}get length(){return this._part.length}}const Z=({icon:i,active:t})=>{const s=p.useMemo(()=>({fill:t?"currentColor":"#ffffff0",fontSize:"inherit"}),[t]);return l.jsx(v,{variant:"h1",sx:{display:"flex",alignItems:"center"},children:C.cloneElement(i,{sx:s})})},$=p.memo(Z);function tt({id:i,noteDuration:t}){let s,e;if(t==="4n")s=i+1,e="#ffa726";else if(t==="8n")s=i%2===0?Math.floor(i/2)+1:"и",e=i%2===0?"#ffa726":"#FFFFFF";else if(t==="16n"){const a=i%4;a===0?(s=Math.floor(i/4)+1,e="#ffa726"):a===1||a===2?(s=a===1?"та":"и",e="#FFFFFF"):(s="та",e="#FFFFFF")}else s=i+1,e="warning.main";return l.jsx(v,{variant:"h4",sx:{textAlign:"center",color:e,textShadow:`0 0 42px ${e}`},children:s})}const st=({noteDuration:i,beatPattern:t,activeBeat:s})=>{const e=t,a=p.useMemo(()=>e.map((o,r)=>{const n=r%2!==0;switch(o){case"0":return n?l.jsx(b,{color:"disabled"}):l.jsx(k,{color:"disabled"});case"1":return n?l.jsx(b,{color:"primary"}):l.jsx(k,{color:"primary"});case"b":return n?l.jsx(Y,{color:"primary"}):l.jsx(X,{color:"primary"});case"h":return n?l.jsx(H,{color:"primary"}):l.jsx(V,{color:"primary"});case"A":return n?l.jsx(b,{color:"warning"}):l.jsx(k,{color:"warning"});case"x":return l.jsx(q,{color:"primary"});case"c":return n?l.jsx(N,{color:"primary"}):l.jsx(P,{color:"primary"});default:return null}}),[e]);return l.jsx(R,{component:"main",container:!0,columns:8,alignItems:"center",justifyContent:"center",children:e.map((o,r)=>l.jsxs(R,{size:{xs:2,sm:1,md:1},sx:{boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minWidth:"max-content"},children:[l.jsx(tt,{id:r,noteDuration:i}),l.jsx($,{icon:a[r],active:s===r})]},r))})},et=p.memo(st),it=""+new URL("click1-CrkR6NUM.wav",import.meta.url).href,at=""+new URL("click2-LM7Avgww.wav",import.meta.url).href,ot=""+new URL("g1-Fk1Yt-Yl.mp3",import.meta.url).href,rt=""+new URL("g2-zlYTM2Qn.mp3",import.meta.url).href,nt=""+new URL("g3-CwlsbLbq.mp3",import.meta.url).href,lt=""+new URL("g4-BBrjkEi4.mp3",import.meta.url).href,ht=""+new URL("g5-B9N5OY6V.mp3",import.meta.url).href,ct=""+new URL("g6-BHzWupgw.mp3",import.meta.url).href,pt=""+new URL("g1L-C3v0XYvl.mp3",import.meta.url).href,ut=""+new URL("g2L-DBaBGgM2.mp3",import.meta.url).href,ft=""+new URL("g3L-BYq5PhOx.mp3",import.meta.url).href,mt=""+new URL("g4L-D7UYUSKR.mp3",import.meta.url).href,dt=""+new URL("g5L-GhzT02A2.mp3",import.meta.url).href,_t=""+new URL("g6L--qZ-q0s2.mp3",import.meta.url).href,gt=""+new URL("g1C-DunAc4-P.mp3",import.meta.url).href,bt=""+new URL("g2C-GsIOIB7y.mp3",import.meta.url).href,kt=""+new URL("g3C-Cs-vB6cC.mp3",import.meta.url).href,wt=""+new URL("g4C-Ce0Ayj6V.mp3",import.meta.url).href,yt=""+new URL("g5C-kmDLrbvQ.mp3",import.meta.url).href,xt=""+new URL("g6C-hrQ_Jl5E.mp3",import.meta.url).href,f={click1:new x(it).toDestination(),click2:new x(at).toDestination()},St=new G({g1:ot,g2:rt,g3:nt,g4:lt,g5:ht,g6:ct,g1L:pt,g2L:ut,g3L:ft,g4L:mt,g5L:dt,g6L:_t,g1C:gt,g2C:bt,g3C:kt,g4C:wt,g5C:yt,g6C:xt}),Et=Array.from({length:6},()=>new W().toDestination()),Lt=Array.from({length:6},(i,t)=>new x().connect(Et[t]));function Rt(i,t,s,e,a){const o=Lt[t];o.state==="started"&&o.stop(s),o.buffer=St.get(i),o.volume.value=e,o.start(s+a,.05)}const O={down:{samples:["g6","g5","g4","g3","g2","g1"],spread:4,bias:[1,2,3,4,5,6],volumes:[-4,-3,0,-3,-3,-5]},downA:{samples:["g6","g5","g4","g3","g2","g1"],spread:6,bias:[1,2,3,4,5,6],volumes:[-4,-3,0,-3,-3,-5]},downB:{samples:["g6","g5","g4","g3","g2","g1"],spread:2,bias:[1,2,3,4,5,6],volumes:[-2,-1,0,-3,-3,-5]},downH:{samples:["g6","g5","g4","g3","g2","g1"],spread:3,bias:[4,5,6,1,2,3],volumes:[-4,-3,0,-1,-1,-3]},up:{samples:["g6","g5","g4","g3","g2","g1"],spread:4,bias:[4,3,2,1,5,6],volumes:[-4,-3,0,-3,-3,-5]},upA:{samples:["g6","g5","g4","g3","g2","g1"],spread:6,bias:[6,5,4,3,2,1],volumes:[-4,-3,0,-3,-3,-5]},upB:{samples:["g6","g5","g4","g3","g2","g1"],spread:2,bias:[2,1,3,4,5,6],volumes:[-2,-1,0,-3,-3,-5]},upH:{samples:["g6","g5","g4","g3","g2","g1"],spread:3,bias:[4,5,6,3,2,1],volumes:[-4,-3,0,-1,-1,-3]},x:{samples:["g6C","g5C","g4C","g3C","g2C","g1C"],spread:6,bias:[1,2,3,4,5,6],volumes:[-10,-10,-10,-8,-5,-4]},upM:{samples:["g6L","g5L","g4L","g3L","g2L","g1L"],spread:4,bias:[1,2,3,4,5,6],volumes:[-4,-3,0,-3,-3,-5]},downM:{samples:["g6L","g5L","g4L","g3L","g2L","g1L"],spread:4,bias:[1,2,3,4,5,6],volumes:[-4,-3,0,-3,-3,-5]}};function Tt(i,t,s){const e=s;for(let a=0;a<6;a++)isNaN(e[a])||t[a]>i&&(e[a]=NaN);return e}function At(i){const s={},a=i==="up"?5:0,o=i==="up"?0:5,r=i==="up"?-1:1;for(let n=0,c=a;i==="up"?c>=o:c<=o;c+=r,n++){let m=n*.004;i==="down"&&c===0&&n>0&&(m+=Math.min(.004,.01)),m+=.001*Math.random(),s[c]=m}return s}function Ot(i,t,s){if(s){let e,a,o,r;switch(i){case"nothing":return;case"up":case"upA":case"upM":case"upB":case"upH":e=O[i],a="up";break;case"down":case"downA":case"downM":case"downB":case"downH":case"x":e=O[i],a="down";break;default:console.log("Note not found in dataset or unsupported note type.");return}o=At(a),r=Tt(e.spread,e.bias,e.volumes),e.samples.forEach((n,c)=>{const m=o[c],L=r[c];isNaN(L)||Rt(n,c,t,L,m)})}}const vt=(i,t,s,e,a,o,r)=>{s&&(o&&t===0?f.click2.start(i):r==="4n"?f.click1.start(i):r==="8n"?t%2===0?e&&f.click1.start(i):a&&f.click1.start(i):r==="16n"&&(t%4===0?e&&f.click1.start(i):a&&f.click1.start(i)))};function Bt(i){return i.split("").map((t,s)=>{let e="nothing";switch(t){case"0":e="nothing";break;case"1":e=s%2===0?"down":"up";break;case"A":e=s%2===0?"downA":"upA";break;case"x":e="x";break;case"c":e=s%2===0?"downM":"upM";break;case"h":e=s%2===0?"downH":"upH";break;case"b":e=s%2===0?"downB":"upB";break;default:e="nothing";break}return e})}function Ct(i){const[t,s]=p.useState(0),e=p.useRef(null);return p.useEffect(()=>{if(!i.isPlaying)return;w().bpm.value=i.tempo||120;const a=Bt(i.beatPattern),o=new E((r,n)=>{const c=a[n];Q().schedule(()=>{s(n)},r),Ot(c,r,i.isBeatSound),vt(r,n,i.isMetronomeSound,i.clickMainBeat,i.clickSubbeat,i.clickTaktBeat,i.noteDuration)},Array.from({length:a.length},(r,n)=>n),i.noteDuration||"8n").start(0);return e.current=o,()=>{o.dispose()}},[i.isPlaying,i.beatPattern,i.isBeatSound,i.isMetronomeSound,i.isDownbeatSound,i.isUpbeatSound,i.isAcsentbeatSound,i.tempo,i.noteDuration,i.clickMainBeat,i.clickSubbeat,i.clickTaktBeat]),p.useEffect(()=>{i.isPlaying?J().then(()=>{w().start()}):w().stop()},[i.isPlaying]),i.isPlaying?t:null}function Ut(){const{config:i}=K(),{beatPattern:t,noteDuration:s}=i,e=Ct(i),a=p.useMemo(()=>t.split(""),[t]),o=p.useMemo(()=>s,[s]);return l.jsx(et,{noteDuration:o,beatPattern:a,activeBeat:e})}export{Ut as default};
