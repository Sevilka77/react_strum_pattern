import{b as l,r as d,j as o,g as q,I as et,M as st,q as b,L as g,E as V}from"./ui-BS00pWUR.js";import{u as $}from"./useCycleSettings-Cv_TbME8.js";import{b as U,a as at,u as X}from"./MetaData-Dm22Wu7v.js";import{A as x,X as G,a as W,b as Y,c as J,d as it,e as O,f as rt,g as ot}from"./Icons-CjB20U9u.js";import{u as v,b as nt}from"./useSequenceSettings-Bwlth80p.js";import{u as lt}from"./useEditMode-CqaAhpmX.js";import{f as D,o as C,h as K,n as ct,i as I,j as f,k as ht,l as M,m as R,p as pt,q as H,r as ut,t as dt,v as ft,w as mt,x as _t,y as bt,z as gt,A as k,B as _,D as w,g as j,E as yt,s as Et}from"./index-zx35-0As.js";import"./vendor-CM9vOon3.js";class y extends D{constructor(){const t=C(y.getDefaults(),arguments,["callback","value"]);super(t),this.name="ToneEvent",this._state=new K("stopped"),this._startOffset=0,this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(D.getDefaults(),{callback:ct,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,e=>{let s;if(e.state==="started"){e.id!==-1&&this.context.transport.clear(e.id);const i=e.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||I(this._loop)&&this._loop>1){s=1/0,I(this._loop)&&(s=this._loop*this._getLoopDuration());const r=this._state.getAfter(i);r!==null&&(s=Math.min(s,r.time-i)),s!==1/0&&(s=new f(this.context,s));const n=new f(this.context,this._getLoopDuration());e.id=this.context.transport.scheduleRepeat(this._tick.bind(this),n,new f(this.context,i),s)}else e.id=this.context.transport.schedule(this._tick.bind(this),new f(this.context,i))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){const e=this.toTicks(t);return this._state.getValueAtTime(e)==="stopped"&&(this._state.add({id:-1,state:"started",time:e}),this._rescheduleEvents(e)),this}stop(t){this.cancel(t);const e=this.toTicks(t);if(this._state.getValueAtTime(e)==="started"){this._state.setStateAtTime("stopped",e,{id:-1});const s=this._state.getBefore(e);let i=e;s!==null&&(i=s.time),this._rescheduleEvents(i)}return this}cancel(t){t=M(t,-1/0);const e=this.toTicks(t);return this._state.forEachFrom(e,s=>{this.context.transport.clear(s.id)}),this._state.cancel(e),this}_tick(t){const e=this.context.transport.getTicksAtTime(t);if(!this.mute&&this._state.getValueAtTime(e)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let s=.02;ht(this.humanize)||(s=this.toSeconds(this.humanize)),t+=(Math.random()*2-1)*s}this.callback(t,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new f(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new f(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const t=this.context.transport.ticks,e=this._state.get(t);if(e!==null&&e.state==="started"){const s=this._getLoopDuration();return(t-e.time)%s/s}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class T extends y{constructor(){const t=C(T.getDefaults(),arguments,["callback","events"]);super(t),this.name="Part",this._state=new K("stopped"),this._events=new Set,this._state.increasing=!0,t.events.forEach(e=>{R(e)?this.add(e[0],e[1]):this.add(e)})}static getDefaults(){return Object.assign(y.getDefaults(),{events:[]})}start(t,e){const s=this.toTicks(t);if(this._state.getValueAtTime(s)!=="started"){e=M(e,this._loop?this._loopStart:0),this._loop?e=M(e,this._loopStart):e=M(e,0);const i=this.toTicks(e);this._state.add({id:-1,offset:i,state:"started",time:s}),this._forEach(r=>{this._startNote(r,s,i)})}return this}_startNote(t,e,s){e-=s,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<s&&(e+=this._getLoopDuration()),t.start(new f(this.context,e))):t.startOffset<this._loopStart&&t.startOffset>=s&&(t.loop=!1,t.start(new f(this.context,e))):t.startOffset>=s&&t.start(new f(this.context,e))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach(e=>{e.startOffset+=this._startOffset})}stop(t){const e=this.toTicks(t);return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._forEach(s=>{s.stop(t)}),this}at(t,e){const s=new pt(this.context,t).toTicks(),i=new f(this.context,1).toSeconds(),r=this._events.values();let n=r.next();for(;!n.done;){const c=n.value;if(Math.abs(s-c.startOffset)<i)return H(e)&&(c.value=e),c;n=r.next()}return H(e)?(this.add(t,e),this.at(t)):null}add(t,e){t instanceof Object&&Reflect.has(t,"time")&&(e=t,t=e.time);const s=this.toTicks(t);let i;return e instanceof y?(i=e,i.callback=this._tick.bind(this)):i=new y({callback:this._tick.bind(this),context:this.context,value:e}),i.startOffset=s,i.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(i),this._restartEvent(i),this}_restartEvent(t){this._state.forEach(e=>{e.state==="started"?this._startNote(t,e.time,e.offset):t.stop(new f(this.context,e.time))})}remove(t,e){return ut(t)&&t.hasOwnProperty("time")&&(e=t,t=e.time),t=this.toTicks(t),this._events.forEach(s=>{s.startOffset===t&&(dt(e)||H(e)&&s.value===e)&&(this._events.delete(s),s.dispose())}),this}clear(){return this._forEach(t=>t.dispose()),this._events.clear(),this}cancel(t){return this._forEach(e=>e.cancel(t)),this._state.cancel(this.toTicks(t)),this}_forEach(t){return this._events&&this._events.forEach(e=>{e instanceof T?e._forEach(t):t(e)}),this}_setAll(t,e){this._forEach(s=>{s[t]=e})}_tick(t,e){this.mute||this.callback(t,e)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):t.state==="stopped"&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(t){this._loop=t,this._forEach(e=>{e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.loop=t,this._testLoopBoundries(e)})}get loopEnd(){return new f(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach(e=>{e.loopEnd=t,this._testLoopBoundries(e)})}get loopStart(){return new f(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach(e=>{e.loopStart=this.loopStart,this._testLoopBoundries(e)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}class B extends y{constructor(){const t=C(B.getDefaults(),arguments,["callback","events","subdivision"]);super(t),this.name="Sequence",this._part=new T({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[],this._subdivision=this.toTicks(t.subdivision),this.events=t.events,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.playbackRate=t.playbackRate,this.probability=t.probability,this.humanize=t.humanize,this.mute=t.mute,this.playbackRate=t.playbackRate}static getDefaults(){return Object.assign(ft(y.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(t,e){e!==null&&!this.mute&&this.callback(t,e)}get events(){return this._events}set events(t){this.clear(),this._eventsArray=t,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(t,e){return this._part.start(t,e&&this._indexTime(e)),this}stop(t){return this._part.stop(t),this}get subdivision(){return new f(this.context,this._subdivision).toSeconds()}_createSequence(t){return new Proxy(t,{get:(e,s)=>e[s],set:(e,s,i)=>(mt(s)&&isFinite(parseInt(s,10))&&R(i)?e[s]=this._createSequence(i):e[s]=i,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(t,e,s){t.forEach((i,r)=>{const n=r*e+s;if(R(i))this._rescheduleSequence(i,e/i.length,n);else{const c=new f(this.context,n,"i").toSeconds();this._part.add(c,i)}})}_indexTime(t){return new f(this.context,t*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(t){this._part.loop=t}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this._part.loopStart=this._indexTime(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,t===0?this._part.loopEnd=this._indexTime(this._eventsArray.length):this._part.loopEnd=this._indexTime(t)}get startOffset(){return this._part.startOffset}set startOffset(t){this._part.startOffset=t}get playbackRate(){return this._part.playbackRate}set playbackRate(t){this._part.playbackRate=t}get probability(){return this._part.probability}set probability(t){this._part.probability=t}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(t){this._part.humanize=t}get length(){return this._part.length}}const kt=new Map([["bold",l.createElement(l.Fragment,null,l.createElement("path",{d:"M88,108H40A12,12,0,0,1,28,96V48a12,12,0,0,1,24,0V67l7.8-7.8A99.42,99.42,0,0,1,130,29.94h.56a99.38,99.38,0,0,1,69.87,28.47,12,12,0,0,1-16.78,17.16,76,76,0,0,0-106.84.63L69,84H88a12,12,0,0,1,0,24Zm128,40H168a12,12,0,0,0,0,24h19l-7.8,7.8a75.55,75.55,0,0,1-53.32,22.26h-.43a75.49,75.49,0,0,1-53.09-21.63,12,12,0,0,0-16.78,17.16,99.38,99.38,0,0,0,69.87,28.47H126a99.42,99.42,0,0,0,70.16-29.29L204,189v19a12,12,0,0,0,24,0V160A12,12,0,0,0,216,148Z"}))],["duotone",l.createElement(l.Fragment,null,l.createElement("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"}),l.createElement("path",{d:"M88,104H40a8,8,0,0,1-8-8V48a8,8,0,0,1,16,0V76.69L62.63,62.06A95.43,95.43,0,0,1,130,33.94h.53a95.36,95.36,0,0,1,67.07,27.33,8,8,0,0,1-11.18,11.44,79.52,79.52,0,0,0-55.89-22.77h-.45A79.56,79.56,0,0,0,73.94,73.37L59.31,88H88a8,8,0,0,1,0,16Zm128,48H168a8,8,0,0,0,0,16h28.69l-14.63,14.63a79.56,79.56,0,0,1-56.13,23.43h-.45a79.52,79.52,0,0,1-55.89-22.77,8,8,0,1,0-11.18,11.44,95.36,95.36,0,0,0,67.07,27.33H126a95.43,95.43,0,0,0,67.36-28.12L208,179.31V208a8,8,0,0,0,16,0V160A8,8,0,0,0,216,152Z"}))],["fill",l.createElement(l.Fragment,null,l.createElement("path",{d:"M88,104H40a8,8,0,0,1-8-8V48a8,8,0,0,1,13.66-5.66L64,60.7a95.42,95.42,0,0,1,66-26.76h.53a95.36,95.36,0,0,1,67.07,27.33,8,8,0,0,1-11.18,11.44,79.52,79.52,0,0,0-55.89-22.77h-.45A79.48,79.48,0,0,0,75.35,72L93.66,90.34A8,8,0,0,1,88,104Zm128,48H168a8,8,0,0,0-5.66,13.66L180.65,184a79.48,79.48,0,0,1-54.72,22.09h-.45a79.52,79.52,0,0,1-55.89-22.77,8,8,0,1,0-11.18,11.44,95.36,95.36,0,0,0,67.07,27.33H126a95.42,95.42,0,0,0,66-26.76l18.36,18.36A8,8,0,0,0,224,208V160A8,8,0,0,0,216,152Z"}))],["light",l.createElement(l.Fragment,null,l.createElement("path",{d:"M88,102H40a6,6,0,0,1-6-6V48a6,6,0,0,1,12,0V81.52l18-18a93.45,93.45,0,0,1,66-27.53h.52A93.39,93.39,0,0,1,196.19,62.7a6,6,0,0,1-8.38,8.58A82,82,0,0,0,72.53,72L54.48,90H88a6,6,0,0,1,0,12Zm128,52H168a6,6,0,0,0,0,12h33.52l-18.05,18a81.51,81.51,0,0,1-57.53,24h-.46a81.5,81.5,0,0,1-57.29-23.34,6,6,0,0,0-8.38,8.58,93.39,93.39,0,0,0,65.67,26.76H126a93.45,93.45,0,0,0,66-27.53l18-18.05V208a6,6,0,0,0,12,0V160A6,6,0,0,0,216,154Z"}))],["regular",l.createElement(l.Fragment,null,l.createElement("path",{d:"M88,104H40a8,8,0,0,1-8-8V48a8,8,0,0,1,16,0V76.69L62.63,62.06A95.43,95.43,0,0,1,130,33.94h.53a95.36,95.36,0,0,1,67.07,27.33,8,8,0,0,1-11.18,11.44,79.52,79.52,0,0,0-55.89-22.77h-.45A79.56,79.56,0,0,0,73.94,73.37L59.31,88H88a8,8,0,0,1,0,16Zm128,48H168a8,8,0,0,0,0,16h28.69l-14.63,14.63a79.56,79.56,0,0,1-56.13,23.43h-.45a79.52,79.52,0,0,1-55.89-22.77,8,8,0,1,0-11.18,11.44,95.36,95.36,0,0,0,67.07,27.33H126a95.43,95.43,0,0,0,67.36-28.12L208,179.31V208a8,8,0,0,0,16,0V160A8,8,0,0,0,216,152Z"}))],["thin",l.createElement(l.Fragment,null,l.createElement("path",{d:"M88,100H40a4,4,0,0,1-4-4V48a4,4,0,0,1,8,0V86.34L65.46,64.89A91.39,91.39,0,0,1,130,37.94h.51A91.43,91.43,0,0,1,194.8,64.13a4,4,0,0,1-5.6,5.72,83.44,83.44,0,0,0-58.68-23.91h-.47a83.52,83.52,0,0,0-58.94,24.6L49.66,92H88a4,4,0,0,1,0,8Zm128,56H168a4,4,0,0,0,0,8h38.34l-21.45,21.46A83.52,83.52,0,0,1,126,210.06h-.47A83.44,83.44,0,0,1,66.8,186.15a4,4,0,0,0-5.6,5.72,91.43,91.43,0,0,0,64.28,26.19H126a91.39,91.39,0,0,0,64.55-26.95L212,169.66V208a4,4,0,0,0,8,0V160A4,4,0,0,0,216,156Z"}))]]),xt=new Map([["bold",l.createElement(l.Fragment,null,l.createElement("path",{d:"M216,36H68.53a20.09,20.09,0,0,0-17.15,9.71L5.71,121.83a12,12,0,0,0,0,12.34l45.67,76.12A20.09,20.09,0,0,0,68.53,220H216a20,20,0,0,0,20-20V56A20,20,0,0,0,216,36Zm-4,160H70.8L30,128,70.8,60H212ZM103.51,143.51,119,128l-15.52-15.51a12,12,0,0,1,17-17L136,111l15.51-15.52a12,12,0,0,1,17,17L153,128l15.52,15.51a12,12,0,0,1-17,17L136,145l-15.51,15.52a12,12,0,0,1-17-17Z"}))],["duotone",l.createElement(l.Fragment,null,l.createElement("path",{d:"M224,56V200a8,8,0,0,1-8,8H68.53a8,8,0,0,1-6.86-3.88L16,128,61.67,51.88A8,8,0,0,1,68.53,48H216A8,8,0,0,1,224,56Z",opacity:"0.2"}),l.createElement("path",{d:"M216,40H68.53a16.08,16.08,0,0,0-13.72,7.77L9.14,123.88a8,8,0,0,0,0,8.24l45.67,76.11A16.08,16.08,0,0,0,68.53,216H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM61.67,204.12,68.53,200h0ZM216,200H68.53l-43.2-72,43.2-72H216ZM106.34,146.34,124.69,128l-18.35-18.34a8,8,0,0,1,11.32-11.32L136,116.69l18.34-18.35a8,8,0,0,1,11.32,11.32L147.31,128l18.35,18.34a8,8,0,0,1-11.32,11.32L136,139.31l-18.34,18.35a8,8,0,0,1-11.32-11.32Z"}))],["fill",l.createElement(l.Fragment,null,l.createElement("path",{d:"M216,40H68.53a16.12,16.12,0,0,0-13.72,7.77L9.14,123.88a8,8,0,0,0,0,8.24l45.67,76.11h0A16.11,16.11,0,0,0,68.53,216H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM165.66,146.34a8,8,0,0,1-11.32,11.32L136,139.31l-18.35,18.35a8,8,0,0,1-11.31-11.32L124.69,128l-18.35-18.34a8,8,0,1,1,11.31-11.32L136,116.69l18.34-18.35a8,8,0,0,1,11.32,11.32L147.31,128Z"}))],["light",l.createElement(l.Fragment,null,l.createElement("path",{d:"M216,42H68.53a14,14,0,0,0-12,6.8L10.86,124.91a6,6,0,0,0,0,6.18L56.53,207.2a14,14,0,0,0,12,6.8H216a14,14,0,0,0,14-14V56A14,14,0,0,0,216,42Zm2,158a2,2,0,0,1-2,2H68.53a2,2,0,0,1-1.71-1h0L23,128,66.82,55a2,2,0,0,1,1.71-1H216a2,2,0,0,1,2,2Zm-53.76-91.76L144.48,128l19.76,19.76a6,6,0,1,1-8.48,8.48L136,136.48l-19.76,19.76a6,6,0,0,1-8.48-8.48L127.52,128l-19.76-19.76a6,6,0,0,1,8.48-8.48L136,119.52l19.76-19.76a6,6,0,0,1,8.48,8.48Z"}))],["regular",l.createElement(l.Fragment,null,l.createElement("path",{d:"M216,40H68.53a16.08,16.08,0,0,0-13.72,7.77L9.14,123.88a8,8,0,0,0,0,8.24l45.67,76.11A16.08,16.08,0,0,0,68.53,216H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM61.67,204.12,68.53,200h0ZM216,200H68.53l-43.2-72,43.2-72H216ZM106.34,146.34,124.69,128l-18.35-18.34a8,8,0,0,1,11.32-11.32L136,116.69l18.34-18.35a8,8,0,0,1,11.32,11.32L147.31,128l18.35,18.34a8,8,0,0,1-11.32,11.32L136,139.31l-18.34,18.35a8,8,0,0,1-11.32-11.32Z"}))],["thin",l.createElement(l.Fragment,null,l.createElement("path",{d:"M216,44H68.53a12.06,12.06,0,0,0-10.29,5.83L12.57,125.94a4,4,0,0,0,0,4.12l45.67,76.11A12.06,12.06,0,0,0,68.53,212H216a12,12,0,0,0,12-12V56A12,12,0,0,0,216,44Zm4,156a4,4,0,0,1-4,4H68.53a4,4,0,0,1-3.43-1.94L20.67,128,65.1,53.94A4,4,0,0,1,68.53,52H216a4,4,0,0,1,4,4Zm-57.17-93.17L141.66,128l21.17,21.17a4,4,0,0,1-5.66,5.66L136,133.66l-21.17,21.17a4,4,0,0,1-5.66-5.66L130.34,128l-21.17-21.17a4,4,0,0,1,5.66-5.66L136,122.34l21.17-21.17a4,4,0,1,1,5.66,5.66Z"}))]]);var St=Object.defineProperty,At=Object.defineProperties,wt=Object.getOwnPropertyDescriptors,Z=Object.getOwnPropertySymbols,jt=Object.prototype.hasOwnProperty,Mt=Object.prototype.propertyIsEnumerable,z=(a,t,e)=>t in a?St(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,Tt=(a,t)=>{for(var e in t||(t={}))jt.call(t,e)&&z(a,e,t[e]);if(Z)for(var e of Z(t))Mt.call(t,e)&&z(a,e,t[e]);return a},Lt=(a,t)=>At(a,wt(t));const Q=d.forwardRef((a,t)=>l.createElement(U,Lt(Tt({ref:t},a),{weights:kt})));Q.displayName="ArrowsCounterClockwise";var Ot=Object.defineProperty,Ht=Object.defineProperties,Rt=Object.getOwnPropertyDescriptors,P=Object.getOwnPropertySymbols,vt=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable,N=(a,t,e)=>t in a?Ot(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,Bt=(a,t)=>{for(var e in t||(t={}))vt.call(t,e)&&N(a,e,t[e]);if(P)for(var e of P(t))Ct.call(t,e)&&N(a,e,t[e]);return a},Ft=(a,t)=>Ht(a,Rt(t));const tt=d.forwardRef((a,t)=>l.createElement(U,Ft(Bt({ref:t},a),{weights:xt})));tt.displayName="Backspace";const Vt=({id:a,icon:t})=>{const{cycleSettings:e}=$();return o.jsx(q,{variant:"h1",component:"p",sx:{display:"flex",alignItems:"center"},children:l.cloneElement(t,{sx:{fill:e.activeBeat===a?"currentColor":"#ffffff0",fontSize:"inherit"}})})},Dt=d.memo(Vt,(a,t)=>a.icon===t.icon&&a.active===t.active),It=(a,t)=>{let e,s;const i=a%4;switch(t){case"4n":e=a+1,s="#ffa726";break;case"8n":e=a%2===0?Math.floor(a/2)+1:"и",s=a%2===0?"#ffa726":"#FFFFFF";break;case"16n":switch(i){case 0:e=Math.floor(a/4)+1,s="#ffa726";break;case 1:case 2:e=i===1?"та":"и",s="#FFFFFF";break;default:e="та",s="#FFFFFF"}break;default:e=a+1,s="warning.main"}return{nameId:e,color:s}};function Zt({id:a,noteDuration:t}){const{nameId:e,color:s}=It(a,t);return o.jsx(q,{variant:"h4",component:"p",sx:{textAlign:"center",color:s,textShadow:`0 0 42px ${s}`},children:e})}const zt=({index:a})=>{const{sequenceSettings:t,dispatch:e}=v(),{beatPattern:s}=t,[i,r]=d.useState(null),n=!!i,c=u=>{const A=s.split("").map((S,L)=>L===a?u:S).join("");e({type:"SET_BEAT_PATTERN",payload:A})},h=()=>{if(a>=0){const u=s.split("").filter((A,S)=>S!==a).join("");e({type:"SET_BEAT_PATTERN",payload:u})}},p=u=>{["A","1","0","x","c","h","b"].includes(u)?c(u):u==="del"&&h(),E()},m=u=>{r(u.currentTarget)},E=()=>{r(null)};return o.jsxs(o.Fragment,{children:[o.jsx(et,{id:"basic-button","aria-controls":n?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":n?"true":void 0,onClick:m,sx:{borderRadius:"8px",border:"2px solid #4A434B",mt:1},children:o.jsx(Q,{})}),o.jsxs(st,{id:"basic-menu",anchorEl:i,open:n,onClose:E,MenuListProps:{"aria-labelledby":"basic-button"},children:[o.jsxs(b,{onClick:()=>p("A"),children:[o.jsx(g,{children:o.jsx(x,{color:"warning"})}),"Акцент"]}),o.jsxs(b,{onClick:()=>p("1"),children:[o.jsx(g,{children:o.jsx(x,{color:"primary"})}),"Удар"]}),o.jsxs(b,{onClick:()=>p("c"),children:[o.jsx(g,{children:o.jsx(G,{color:"primary"})}),"По заглушеным"]}),o.jsxs(b,{onClick:()=>p("b"),children:[o.jsx(g,{children:o.jsx(W,{color:"primary"})}),"По басам"]}),o.jsxs(b,{onClick:()=>p("h"),children:[o.jsx(g,{children:o.jsx(Y,{color:"primary"})}),"По высоким"]}),o.jsxs(b,{onClick:()=>p("x"),children:[o.jsx(g,{children:o.jsx(J,{color:"primary"})}),"Заглушка"]}),o.jsxs(b,{onClick:()=>p("0"),children:[o.jsx(g,{children:o.jsx(x,{color:"disabled"})}),"Пропуск"]}),o.jsxs(b,{onClick:()=>p("del"),children:[o.jsx(g,{children:o.jsx(tt,{})}),"Удалить"]})]})]})},Pt=d.memo(zt),Nt=(a,t)=>{switch(a){case"0":return t?o.jsx(O,{color:"disabled"}):o.jsx(x,{color:"disabled"});case"1":return t?o.jsx(O,{color:"primary"}):o.jsx(x,{color:"primary"});case"b":return t?o.jsx(ot,{color:"primary"}):o.jsx(W,{color:"primary"});case"h":return t?o.jsx(rt,{color:"primary"}):o.jsx(Y,{color:"primary"});case"A":return t?o.jsx(O,{color:"warning"}):o.jsx(x,{color:"warning"});case"x":return o.jsx(J,{color:"primary"});case"c":return t?o.jsx(it,{color:"primary"}):o.jsx(G,{color:"primary"});default:return null}},qt=({noteDuration:a,beatPattern:t})=>{const{editMode:e}=lt(),s=t,i=d.useMemo(()=>t.map((r,n)=>{const c=n%2!==0;return Nt(r,c)}),[t]);return o.jsx(o.Fragment,{children:o.jsx(V,{container:!0,columns:8,alignContent:"center",alignItems:"center",justifyContent:"center",flexGrow:"1",children:s.map((r,n)=>o.jsxs(V,{size:{xs:2,sm:1,md:1},sx:{boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minWidth:"max-content"},children:[o.jsx(Zt,{id:n,noteDuration:a}),o.jsx(Dt,{id:n,icon:i[n]}),e.edit&&o.jsx(Pt,{index:n})]},n))})})},$t=d.memo(qt),Ut={down:{type:"play",spread:3.7,bias:"strumD"},downA:{type:"play",spread:6,bias:"strumD",accent:!0},downB:{type:"play",spread:2,bias:"low"},downH:{type:"play",spread:3,bias:"high"},up:{type:"play",spread:3.7,bias:"strumU"},upA:{type:"play",spread:6,bias:"strum",accent:!0},upB:{type:"play",spread:2,bias:"low"},upH:{type:"play",spread:3,bias:"high"},x:{type:"chop",spread:6,bias:"low"},upM:{type:"mute",spread:6,bias:"low"},downM:{type:"mute",spread:6,bias:"low"},nothing:{type:"nothing",spread:0,bias:"no"}};function Xt(a,t){const e=_t[a];if(!e)return console.warn(`Аккорд ${a} не найден!`),[];const{spread:s,bias:i}=t,r=e.config.bias[i],n=e.config.stringVolumes.slice();let c=s+Math.random();for(let h=0;h<6;h++)isNaN(n[h])||(isNaN(r[h])?n[h]=NaN:r[h]>Math.ceil(c)?n[h]=NaN:r[h]>Math.floor(c)&&(n[h]=c%1>.25?n[h]-26*(1-Math.log10(1+c%1*9)):NaN));return n}function Gt(a,t){const e=t.accent?.001:.005,s=[],i=5,r=a==="up"?i:0,n=a==="up"?0:i,c=a==="up"?-1:1;for(let h=0,p=r;a==="up"?p>=n:p<=n;p+=c,h++)s[p]=h*e+.001*Math.random();return s}function Wt(a,t){const e={0:()=>"nothing",1:i=>i%2===0?"down":"up",A:i=>i%2===0?"downA":"upA",x:()=>"x",c:i=>i%2===0?"downM":"upM",h:i=>i%2===0?"downH":"upH",b:i=>i%2===0?"downB":"upB"},s=bt(t);return!s||!s.length?(console.warn(`Сэмплы для аккорда ${t} не найдены!`),[]):a.split("").map((i,r)=>{const c=(e[i]||(()=>"nothing"))(r),h=r%2===0?"down":"up",p=Ut[c]||{},{type:m,accent:E}=p,u=Gt(h,p),A=Xt(t,p),S=s.map((L,F)=>({type:m,sample:L,db:A[F]+0,offset:u[F]}));return{index:r,instructions:S}})}function Yt(a,t,e,s,i){let r;switch(t){case"play":r=a.concat("Z");break;case"mute":r=a.replace(/[^o]/g,"F").concat("Z");break;case"chop":r=a.concat("C");break;default:r=a}if(!_[r]){console.warn(`Player ${r} not loaded`);return}if(w[_[r].stringId]){let n=w[_[r].stringId];_[n]&&(_[n].fadeOut=.05,_[n].stop(e),w[_[r].stringId]="")}_[r].volume.value=t=="chop"?s-7:t=="mute"?s+5:s,w[_[r].stringId]=r,_[r].start(e+i,.03)}function Jt(a,t){a.forEach(e=>{const{type:s,sample:i,db:r,offset:n}=e;s!=="nothing"&&!isNaN(r)&&Yt(i,s,t,r,n)})}function Kt(a,t){a[0].type!="nothing"&&gt.hihat.start(t)}const Qt=(a,t,e,s,i,r)=>{i&&t===0?k.click2.start(a):r==="4n"?k.click1.start(a):r==="8n"?t%2===0?e&&k.click1.start(a):s&&k.click1.start(a):r==="16n"&&(t%4===0?e&&k.click1.start(a):s&&k.click1.start(a))},te=()=>{const{soundSettings:a}=at(),{toneSettings:t}=X(),{sequenceSettings:e}=v(),{chordSettings:s}=nt(),{beatPattern:i}=e,{dispatch:r}=$(),n=d.useRef(null),c=d.useRef([]);d.useEffect(()=>{c.current=Wt(i,s.currentChord)},[i,s.currentChord]),d.useEffect(()=>{j().bpm.value=t.tempo||120},[t.tempo]);const h=d.useCallback((p,m)=>{const E=c.current[m].instructions,u=p+.1;yt().schedule(()=>{m===c.current.length-1&&r({type:"INCREMENT_CYCLE"}),r({type:"SET_ACTIVE_BEAT",payload:m})},u),a.isBeatSound&&Jt(E,u,a.isBeatSound),a.isHitSound&&Kt(E,u),a.isMetronomeSound&&Qt(u,m,a.clickMainBeat,a.clickSubbeat,a.clickTaktBeat,t.noteDuration)},[a.isBeatSound,a.isHitSound,a.isMetronomeSound,a.clickMainBeat,a.clickSubbeat,a.clickTaktBeat,r,t.noteDuration]);d.useEffect(()=>(n.current&&n.current.dispose(),n.current=new B(h,Array.from({length:c.current.length},(p,m)=>m),t.noteDuration||"8n").start(0),()=>{n.current&&n.current.dispose()}),[i,s.currentChord,t.noteDuration,h]),d.useEffect(()=>{if(!t.isPlaying){j().stop(),r({type:"SET_ACTIVE_BEAT",payload:null});return}return Et().then(()=>{j().start()}),()=>{j().stop(),r({type:"RESET_CYCLE"})}},[t.isPlaying,r])},ce=()=>{const{sequenceSettings:a}=v(),{beatPattern:t}=a,{toneSettings:e}=X();te();const s=d.useMemo(()=>t.split(""),[t]),i=d.useMemo(()=>e.noteDuration,[e.noteDuration]);return o.jsx($t,{noteDuration:i,beatPattern:s})};export{ce as MetronomePlayer};
